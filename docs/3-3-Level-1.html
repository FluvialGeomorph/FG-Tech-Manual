<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Level 1 Workflow – FluvialGeomorph Technical Manual</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./3-4-Level-2.html" rel="next">
<link href="./3-2-CreateTerrain.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./3-1-Workflows.html">Workflows</a></li><li class="breadcrumb-item"><a href="./3-3-Level-1.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Level 1 Workflow</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">FluvialGeomorph Technical Manual</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/FluvialGeomorph/FG-Tech-Manual" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0-1-Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-1-Concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-2-Metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Metrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-3-FieldMethods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Field Methods</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-1-Install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Install</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-2-TutorialData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tutorial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-3-Toolbox.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Toolbox</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-4-Features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Features</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-5-Reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Reports</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Workflows</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-1-Workflows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-2-CreateTerrain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Create Terrain</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-3-Level-1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Level 1 Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-4-Level-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Level 2 Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-5-Level-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Level 3 Workflow</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0-7-References.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-1-QAChecklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">QA Checklist</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#hydro-modify-dem" id="toc-hydro-modify-dem" class="nav-link active" data-scroll-target="#hydro-modify-dem">Hydro Modify DEM</a>
  <ul class="collapse">
  <li><a href="#identify-flow-blockages" id="toc-identify-flow-blockages" class="nav-link" data-scroll-target="#identify-flow-blockages">Identify Flow Blockages</a></li>
  <li><a href="#burn-cutlines-into-the-terrain" id="toc-burn-cutlines-into-the-terrain" class="nav-link" data-scroll-target="#burn-cutlines-into-the-terrain">Burn cutlines into the terrain</a></li>
  </ul></li>
  <li><a href="#define-stream-reaches" id="toc-define-stream-reaches" class="nav-link" data-scroll-target="#define-stream-reaches">Define Stream Reaches</a>
  <ul class="collapse">
  <li><a href="#calculate-contributing-area" id="toc-calculate-contributing-area" class="nav-link" data-scroll-target="#calculate-contributing-area">Calculate Contributing Area</a></li>
  <li><a href="#derive-stream-network" id="toc-derive-stream-network" class="nav-link" data-scroll-target="#derive-stream-network">Derive Stream Network</a></li>
  <li><a href="#calculate-slope-and-sinuosity" id="toc-calculate-slope-and-sinuosity" class="nav-link" data-scroll-target="#calculate-slope-and-sinuosity">Calculate Slope and Sinuosity</a></li>
  <li><a href="#define-reaches" id="toc-define-reaches" class="nav-link" data-scroll-target="#define-reaches">Define Reaches</a></li>
  <li><a href="#delineate-watersheds" id="toc-delineate-watersheds" class="nav-link" data-scroll-target="#delineate-watersheds">Delineate Watersheds</a></li>
  </ul></li>
  <li><a href="#derive-flowline" id="toc-derive-flowline" class="nav-link" data-scroll-target="#derive-flowline">Derive Flowline</a>
  <ul class="collapse">
  <li><a href="#create-the-site-geodatabase" id="toc-create-the-site-geodatabase" class="nav-link" data-scroll-target="#create-the-site-geodatabase">Create the site geodatabase</a></li>
  <li><a href="#create-the-flowline" id="toc-create-the-flowline" class="nav-link" data-scroll-target="#create-the-flowline">Create the Flowline</a></li>
  <li><a href="#create-the-reach-geodatabase" id="toc-create-the-reach-geodatabase" class="nav-link" data-scroll-target="#create-the-reach-geodatabase">Create the Reach Geodatabase</a></li>
  <li><a href="#create-flowline-points" id="toc-create-flowline-points" class="nav-link" data-scroll-target="#create-flowline-points">Create Flowline Points</a></li>
  </ul></li>
  <li><a href="#define-initial-floodplain-and-channel-extent" id="toc-define-initial-floodplain-and-channel-extent" class="nav-link" data-scroll-target="#define-initial-floodplain-and-channel-extent">Define Initial Floodplain and Channel Extent</a>
  <ul class="collapse">
  <li><a href="#detrend-dem" id="toc-detrend-dem" class="nav-link" data-scroll-target="#detrend-dem">Detrend DEM</a></li>
  <li><a href="#estimate-initial-channel-extent" id="toc-estimate-initial-channel-extent" class="nav-link" data-scroll-target="#estimate-initial-channel-extent">Estimate Initial Channel Extent</a></li>
  <li><a href="#create-the-initial-channel-mask-layer" id="toc-create-the-initial-channel-mask-layer" class="nav-link" data-scroll-target="#create-the-initial-channel-mask-layer">Create the Initial Channel Mask layer</a></li>
  <li><a href="#estimate-initial-floodplain-extent" id="toc-estimate-initial-floodplain-extent" class="nav-link" data-scroll-target="#estimate-initial-floodplain-extent">Estimate Initial Floodplain Extent</a></li>
  <li><a href="#calculate-channel-slope-raster" id="toc-calculate-channel-slope-raster" class="nav-link" data-scroll-target="#calculate-channel-slope-raster">Calculate Channel Slope Raster</a></li>
  <li><a href="#create-initial-centerline" id="toc-create-initial-centerline" class="nav-link" data-scroll-target="#create-initial-centerline">Create Initial Centerline</a></li>
  </ul></li>
  <li><a href="#create-regular-cross-section-geometry" id="toc-create-regular-cross-section-geometry" class="nav-link" data-scroll-target="#create-regular-cross-section-geometry">Create Regular Cross Section Geometry</a>
  <ul class="collapse">
  <li><a href="#create-regular-cross-sections" id="toc-create-regular-cross-sections" class="nav-link" data-scroll-target="#create-regular-cross-sections">Create Regular Cross Sections</a></li>
  <li><a href="#calculate-cross-section-watershed-area" id="toc-calculate-cross-section-watershed-area" class="nav-link" data-scroll-target="#calculate-cross-section-watershed-area">Calculate Cross Section Watershed Area</a></li>
  <li><a href="#calculate-cross-section-river-position" id="toc-calculate-cross-section-river-position" class="nav-link" data-scroll-target="#calculate-cross-section-river-position">Calculate Cross Section River Position</a></li>
  <li><a href="#calculate-cross-section-points" id="toc-calculate-cross-section-points" class="nav-link" data-scroll-target="#calculate-cross-section-points">Calculate Cross Section Points</a></li>
  <li><a href="#calculate-cross-section-l1-dimensions" id="toc-calculate-cross-section-l1-dimensions" class="nav-link" data-scroll-target="#calculate-cross-section-l1-dimensions">Calculate Cross Section L1 Dimensions</a></li>
  </ul></li>
  <li><a href="#identify-infrastructure" id="toc-identify-infrastructure" class="nav-link" data-scroll-target="#identify-infrastructure">Identify Infrastructure</a>
  <ul class="collapse">
  <li><a href="#create-features" id="toc-create-features" class="nav-link" data-scroll-target="#create-features">Create Features</a></li>
  </ul></li>
  <li><a href="#run-report" id="toc-run-report" class="nav-link" data-scroll-target="#run-report">Run Report</a>
  <ul class="collapse">
  <li><a href="#run-the-level-1-report" id="toc-run-the-level-1-report" class="nav-link" data-scroll-target="#run-the-level-1-report">Run the Level 1 Report</a></li>
  <li><a href="#perform-qa" id="toc-perform-qa" class="nav-link" data-scroll-target="#perform-qa">Perform QA</a></li>
  </ul></li>
  <li><a href="#determine-next-steps" id="toc-determine-next-steps" class="nav-link" data-scroll-target="#determine-next-steps">Determine Next Steps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./3-1-Workflows.html">Workflows</a></li><li class="breadcrumb-item"><a href="./3-3-Level-1.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Level 1 Workflow</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Level 1 Workflow</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This chapter describes the workflow steps necessary to complete a Level 1 (L1) FluvialGeomorph analysis. The purpose of this level is to extract basic channel dimensions from LiDAR surveys.</p>
<section id="hydro-modify-dem" class="level2">
<h2 class="anchored" data-anchor-id="hydro-modify-dem">Hydro Modify DEM</h2>
<p>The purpose of this step is to create a hydro-modified DEM to ensure proper water flow across the study area.</p>
<section id="identify-flow-blockages" class="level3">
<h3 class="anchored" data-anchor-id="identify-flow-blockages">Identify Flow Blockages</h3>
<p>The purpose of this step is to develop a <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#cutlines-fc"><code>cutlines</code></a> feature class representing flow blockages in the study area.</p>
<ul>
<li>Examine the stream channel to be analyzed through the study area and determine if there are any blockages to flow in the DEM.</li>
<li>Focus only on flow blockages within the main channel of the study reaches. Flow blockages outside of the the channels of the study reaches do not need to be identified for FluvialGeomorph analysis.</li>
<li>These blockages are typically built infrastructure such as road embankments where streams are conveyed through culverts or underground storm water structures.</li>
<li>If there are flow blockages in the study area reach channels, create a new line feature class named <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#cutlines-fc"><code>cutlines</code></a> to store terrain modifications that remove flow blockages. This feature class must be in the same coordinate system as the DEM being modified.</li>
<li>In an edit session, identify human structures that block flow along the channel of the stream reach being studied.</li>
<li>Draw a cutline beginning at the upstream side of the blockage to a point just downstream of the blockage.</li>
<li>The start point and end point of the cutline must cover the area to be modified.</li>
<li>The downstream end of this cutline must be located in “good data”, because the lowest DEM value found along this line will be used to re-assign DEM values to all DEM pixels covered by the cutline.</li>
</ul>
</section>
<section id="burn-cutlines-into-the-terrain" class="level3">
<h3 class="anchored" data-anchor-id="burn-cutlines-into-the-terrain">Burn cutlines into the terrain</h3>
<p>The purpose of this step is to remove flow blockages from the terrain.</p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#hydro-dem-tool"><code>02 - Hydro DEM</code></a> tool to “burn” the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#cutlines"><code>cutlines</code></a> features into the study area watershed DEM. This tool creates the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#dem-hydro-raster"><code>dem_hydro</code></a> raster. Rename this DEM <code>watershed_dem_hydro</code>.</li>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#hydro-dem-tool"><code>02 - Hydro DEM</code></a> tool to “burn” the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#cutlines"><code>cutlines</code></a> features into the high resolution DEM. This tool creates the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#dem-hydro-raster"><code>dem_hydro</code></a> raster.</li>
</ul>
<hr>
</section>
</section>
<section id="define-stream-reaches" class="level2">
<h2 class="anchored" data-anchor-id="define-stream-reaches">Define Stream Reaches</h2>
<p>The purpose of this stage is to synthetically derive from the terrain the study area reaches and their watersheds.</p>
<section id="calculate-contributing-area" class="level3">
<h3 class="anchored" data-anchor-id="calculate-contributing-area">Calculate Contributing Area</h3>
<p>The purpose of this step is to calculate the contributing drainage area for each pixel in the DEM.</p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#contributing-area-d8-tool"><code>03a - Contributing Area D8</code></a> tool to calculate the contributing area for the study area watershed. This tool creates the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#contributing-area-raster"><code>contributing_area</code></a> raster. Rename this DEM <code>watershed_contributing_area</code>.</li>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#contributing-area-d8-tool"><code>03a - Contributing Area D8</code></a> tool to calculate the contributing area for the high resolution DEM. If created, use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#dem-hydro-raster"><code>dem_hydro</code></a> raster as input.<br>
</li>
<li>The <code>processes</code> parameter of the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#contributing-area-d8-tool"><code>03a - Contributing Area D8</code></a> tool can be safely set to approximately 2 less than the number of cores on the computer running the tool.</li>
</ul>
</section>
<section id="derive-stream-network" class="level3">
<h3 class="anchored" data-anchor-id="derive-stream-network">Derive Stream Network</h3>
<p>The purpose of this step is to derive a synthetic vector stream network from the DEM for the study area.</p>
<ul>
<li>Use the high resolution DEM to derive the stream network.</li>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-tool"><code>04 - Stream Network</code></a> tool to create a synthetic stream network from the hydro-modified DEM. The <code>processes</code> parameter can be safely set to approximately 2 less than the number of cores on the computer running the tool.</li>
<li>The <code>threshold</code> parameter should be set to a value of 200,000 to 500,000 depending on the study area.<br>
</li>
<li>If the resulting <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class is too dense (requiring a large amount of editing to remove extraneous tributaries), try rerunning the tool and increasing the <code>threshold</code> value. Conversely, if the resulting <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class is too sparse (not enough of the stream network was delineated), try rerunning the tool and decreasing the <code>threshold</code> value.<br>
</li>
<li>Edit the resulting <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class to remove all tributary streams that do not constitute the network that will be analyzed in this study.<br>
</li>
<li>Edit the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class to ensure that stream segments are represented by a single line and that there are no gaps in the steam network.</li>
</ul>
</section>
<section id="calculate-slope-and-sinuosity" class="level3">
<h3 class="anchored" data-anchor-id="calculate-slope-and-sinuosity">Calculate Slope and Sinuosity</h3>
<p>The purpose of this step is to examine the stream network slope and sinuosity to help make decisions about how best to define study reaches.</p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-points-tool"><code>04a - Stream Network Points</code></a> tool to convert the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class into the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-points-fc"><code>stream_networks_points</code></a> feature class.</li>
</ul>
<p><strong>Determine the moving window size</strong><br>
Slope and sinuosity are scale dependent metrics. This means that these metrics are affected by the size of the upstream moving window used in their calculation. To determine the appropriate size of this moving window for this study area, use the following steps:</p>
<ul>
<li>It is recommended that slope and sinuosity be calculated using a moving window size equal to two meander wavelengths.</li>
<li>Estimate a rough initial bankfull width for the reach. Use the DEM to examine several representative locations throughout the study area.</li>
<li>Estimate the length of two meander wavelengths by multiplying the rough bankfull width by 10 (e.g., 30ft bankfull width * 10 = 300ft, two meander wavelengths).<br>
</li>
<li>Determine how many <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-points-fc"><code>stream_networks_points</code></a> two meander wavelengths represent. For example, if <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-points-fc"><code>stream_networks_points</code></a> are spaced 1m apart on average, then two meander wavelengths would be 91 points (i.e., 300ft / 3.28084ft per m).</li>
</ul>
<p><strong>Calculate Slope and Sinuosity</strong></p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#slope-sinuosity-tool"><code>04b - Slope and Sinuosity</code></a> tool to calculate the slope and sinuosity of the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-points-fc"><code>stream_networks_points</code></a> feature class.</li>
<li>Set the <code>gradient_distance</code> parameter to the number of upstream <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-points-fc"><code>stream_networks_points</code></a> that you calculated in a previous step.</li>
<li>If the elevations in the channel seem noisy, check the <code>use_smoothing</code> parameter and set the <code>loess_span</code> parameter to a value between 0-1.</li>
</ul>
<p><strong>Confirm the degree of smoothing</strong></p>
<ul>
<li>Use a chart to verify the choice of the smoothing <code>loess_span</code> parameter.</li>
<li>Right-click on the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#gradient-fc"><code>gradient_*</code></a> feature class in the map Table of Contents and select “Create Chart”, and select “Line”. In the <code>Date or Number</code> dropdown, choose the field <code>POINT_M</code>. In the <code>Aggregation</code> dropdown, choose <code>None</code>. In the <code>Numeric field(s)</code> checklist, check the boxes next to <code>Z</code> and <code>Z_smooth</code>. Click the <code>Apply</code> button to view the chart.</li>
<li>Visually assess the degree of smoothing. The smoothing should be high enough to eliminate LiDAR elevation noise, but not so high as to eliminate meaningful channel elevation change.</li>
<li>If the smoothing is not ideal, re-run the tool and adjust the <code>loess_span</code> parameter.</li>
</ul>
</section>
<section id="define-reaches" class="level3">
<h3 class="anchored" data-anchor-id="define-reaches">Define Reaches</h3>
<p>The purpose of this step is to segment the stream network into a set of sites and reaches that can be analyzed in more detail through the remainder of the study. The <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> must be sub-divided into a set of sites and reaches that meet the following requirements:</p>
<p><strong>Criteria for Creating Sites:</strong></p>
<ul>
<li>A project study area composed of several sub-watersheds will need to be divided into a set of <a href="#units_of_analysis">sites</a>.</li>
<li>Sites within a project area are typically named tributaries that are the next hierarchical level beneath the project.</li>
</ul>
<p><strong>Criteria for Creating Reaches:</strong></p>
<ul>
<li>“Major” tributaries should be used to divide a site into reaches. How big of an increase in drainage area/discharge constitutes a major tributary depends on the size of the watershed and physiographic region.</li>
<li>A specific reach should contain a range of similar drainage area values.</li>
<li>Slope and sinuosity can be considered in the decision to subdivide a reach.</li>
<li>Built infrastructure may be used to divide reaches (e.g., dams, major roads).</li>
<li>Study objectives may drive the definition of reaches (e.g., economic benefits analysis, existing project reach definition).</li>
<li>The distribution of the slope and sinuosity values along the stream network may help determine the natural breaks in the stream network.</li>
</ul>
<p>Using the criteria chosen from the list above, use the standard ESRI edit tools to subdivide the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class into a set of features representing the reaches of your study.</p>
<ul>
<li>Manually edit the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class to modify the geometry to create a set of features representing the study area sites and reaches.<br>
</li>
<li>Set the <code>ReachName</code> field to the value to be used to uniquely define sites and reaches throughout the remainder of the study.</li>
<li>Reach names are typically created using the site name and adding a suffix for the reach (e.g., R1, R2, etc.).</li>
<li>Site names are typically defined by the primary tributary name.</li>
<li>Be deliberate with the naming of sites and reaches as these names are used for all operations by each tool.</li>
</ul>
</section>
<section id="delineate-watersheds" class="level3">
<h3 class="anchored" data-anchor-id="delineate-watersheds">Delineate Watersheds</h3>
<p>The purpose of this step is to delineate the areal extent of watersheds for each reach in the study area.</p>
<ul>
<li>In the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-points-fc"><code>stream_network_points</code></a> feature class, select points that represent the downstream location of each of the sites in the project study area.</li>
<li>Export these point features to a new feature class named <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#watershed-points-fc"><code>watershed_points</code></a> in the study area geodatabase.</li>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#watershed-tool"><code>04c - Watershed</code></a> tool to create a watershed polygon for each feature in the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#watershed-points-fc"><code>watershed_points</code></a> feature class.</li>
</ul>
<hr>
</section>
</section>
<section id="derive-flowline" class="level2">
<h2 class="anchored" data-anchor-id="derive-flowline">Derive Flowline</h2>
<p>The purpose of this stage is to create a new site geodatabase, derive the site flowline, create new reach geodatabases for each reach, and copy the flowline to each reach’s geodatabase.</p>
<section id="create-the-site-geodatabase" class="level3">
<h3 class="anchored" data-anchor-id="create-the-site-geodatabase">Create the site geodatabase</h3>
<p>The purpose of this step is to create a new site geodatabase and populate it with initial data.</p>
<ul>
<li><p>In the <a href="#folder_structure">study area folder</a>, begin by creating a new site folder named for the site.<br>
</p></li>
<li><p>In the new site folder, create a new “Data” folder.</p></li>
<li><p>In the new site data folder, create a new site geodatabase for each LiDAR survey. In the example above, the Papillion Creek project study area will be subdivided into a specific site called Cole Creek. Since there are multiple LiDAR surveys for this study area (e.g., 2016, 2010, 2006), three site geodatabases will need to be created.</p>
<ul>
<li>Cole_Creek_2016.gdb<br>
</li>
<li>Cole_Creek_2010.gdb<br>
</li>
<li>Cole_Creek_2006.gdb</li>
</ul></li>
<li><p>Back in the study area geodatabase, select the features in the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class representing the current site. Use the “Data | Export Features” function to export the selected site features to the new site geodatabase. Name the exported feature class <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a>.</p></li>
<li><p>Examine the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#dem-hydro-raster"><code>dem_hydro</code></a> raster and determine the maximum width of the active floodplain along the entire site. Be conservative with this estimate. Given its later use, it is important to generously overestimate this value.</p></li>
<li><p>Use this maximum floodplain width estimate to buffer the reach <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class and name it <code>stream_network_buffer</code>.</p></li>
<li><p>Use the <a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/data-management/clip.htm">ESRI <code>Clip Raster</code></a> tool to clip the study area geodatabase <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#dem-hydro-raster"><code>dem_hydro</code></a> to the extent of the reach using the <code>stream_network_buffer</code> feature class. Save the clipped raster to the reach geodatabase and name it <code>dem_hydro_&lt;buffer distance&gt;</code> (e.g., <code>dem_hydro_1000</code> for a buffer distance of 1000 meters).</p></li>
<li><p>Use the <a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/data-management/clip.htm">ESRI <code>Clip Raster</code></a> tool to clip the study area geodatabase <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#contributing-area-raster"><code>contributing_area</code></a> to the extent of the reach using the <code>stream_network_buffer</code> feature class. Save the clipped raster to the reach geodatabase and name it <code>contributing_area_&lt;buffer distance&gt;</code> (e.g., <code>contributing_area_1000</code> for a buffer distance of 1000 meters).<br>
</p></li>
<li><p>If you discover in later steps that the buffer distance was underestimated, you will need to repeat this step with a wider buffer.</p></li>
</ul>
</section>
<section id="create-the-flowline" class="level3">
<h3 class="anchored" data-anchor-id="create-the-flowline">Create the Flowline</h3>
<p>The purpose of this step is to derive the site flowline. The <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-tool"><code>05 - Flowline</code></a> tool converts a <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature into a <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class. This tool smooths the <a href="file:///D:/Workspace/EMRRP_Sediment/Documents/TechReports/TechManual/docs/toolbox.html#stream-network-fc"><code>stream_network</code></a> geometry and converts the flowline into a route.</p>
<ul>
<li>Use the <a href="file:///D:/Workspace/EMRRP_Sediment/Documents/TechReports/TechManual/docs/toolbox.html#flowline-tool"><code>05 - Flowline</code></a> tool to process the site <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#stream-network-fc"><code>stream_network</code></a> feature class to produce a new <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class.</li>
<li>Set the <code>output_workspace</code> parameter to the site geodatabase.</li>
<li>Use a <code>smooth_tolerance</code> parameter value from 5-20. The goal is to produce a smooth flowline, but not to remove too much resolution from the line.</li>
<li>Ensure that the flowline remains in the channel and is not simplified into the floodplain. If this occurs, rerun reducing the degree of smoothing.</li>
<li>Edit the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class to ensure that the flowline is digitized beginning with the downstream end and digitized upstream.</li>
<li>In an edit session, select the flowline feature, choose to edit vertices, and ensure that the red endpoint is at the upstream end of the flowline.</li>
<li>If not, use the “Reverse Direction” (aka flip) command to ensure the flowline is digitized in the upstream direction.<br>
</li>
<li>It is critical that the flowline is digitized in the upstream direction. If this step is not performed, all subsequent tools will malfunction.</li>
</ul>
</section>
<section id="create-the-reach-geodatabase" class="level3">
<h3 class="anchored" data-anchor-id="create-the-reach-geodatabase">Create the Reach Geodatabase</h3>
<p>The purpose of this step is to create a set of new reach geodatabases for each reach in a site and populate these reach geodatabases with initial data. This step will need to be repeated for each reach AND survey in the project study area <a href="#units_of_analysis">site</a>. For example, if a site has five reaches (e.g., R1-R5) and three LiDAR surveys (e.g., 2016, 2010, 2006), then a total of 15 reach geodatabases must be created at this stage:</p>
<table class="caption-top table">
<caption>Reach Geodatabases Required for a Site with 5 Reaches and 3 LiDAR Surveys.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">2016</th>
<th style="text-align: left;">2010</th>
<th style="text-align: left;">2006</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">y2016_R1.gdb</td>
<td style="text-align: left;">y2010_R1.gdb</td>
<td style="text-align: left;">y2006_R1.gdb</td>
</tr>
<tr class="even">
<td style="text-align: left;">y2016_R2.gdb</td>
<td style="text-align: left;">y2010_R2.gdb</td>
<td style="text-align: left;">y2006_R2.gdb</td>
</tr>
<tr class="odd">
<td style="text-align: left;">y2016_R3.gdb</td>
<td style="text-align: left;">y2010_R3.gdb</td>
<td style="text-align: left;">y2006_R3.gdb</td>
</tr>
<tr class="even">
<td style="text-align: left;">y2016_R4.gdb</td>
<td style="text-align: left;">y2010_R4.gdb</td>
<td style="text-align: left;">y2006_R4.gdb</td>
</tr>
<tr class="odd">
<td style="text-align: left;">y2016_R5.gdb</td>
<td style="text-align: left;">y2010_R5.gdb</td>
<td style="text-align: left;">y2006_R5.gdb</td>
</tr>
</tbody>
</table>
<ul>
<li>In the <a href="#folder_structure">site data folder</a>, create a new reach geodatabase named for the reach. Use the <code>ReachName</code> value for the name of this new reach file geodatabase.</li>
<li>Reach names are typically created using the site name and adding a suffix for the reach (e.g., R1, R2, etc.).</li>
<li>Back in the site geodatabase, select the feature in the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class representing the current study reach. Use the “Data | Export Features” function to export the selected reach feature to the new reach geodatabase. Name the exported feature class <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a>.</li>
<li>Ensure this new reach geodatabase version of <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> contains only one feature representing the current reach.</li>
<li>Ensure that the <code>ReachName</code> field contains the correct name for the reach. As this reach name value is used throughout the toolbox, it is extremely important to ensure this value is used consistently across all feature classes for this reach. Failure to be consistent with the <code>ReachName</code> value will lead to lots of errors that are difficult to troubleshoot. Get it right from the beginning.</li>
</ul>
</section>
<section id="create-flowline-points" class="level3">
<h3 class="anchored" data-anchor-id="create-flowline-points">Create Flowline Points</h3>
<p>The purpose of this step is convert the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> into a series of points along the reach. The <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-tool"><code>06 - Flowline Points</code></a> tool takes the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class, converts it to a route, calculates the distance to the mouth of the river for all vertices, and creates a <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> feature class.</p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-tool"><code>06 - Flowline Points</code></a> tool to convert the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class into a new feature class named <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a>.</li>
<li>Set the <code>station_distance</code> field to approximately 1 meter.</li>
<li>For a site with multiple reaches, set the <code>km_to_mouth</code> parameter for the downstream-most reach to 0.</li>
<li>Set the <code>km_to_mouth</code> parameter for each upstream reach to the upstream-most value (i.e., the highest <code>km_to_mouth</code> value of the downstream reach’s <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> feature class) of the downstream reach. For example, set the <code>km_to_mouth</code> of the Reach-2 <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> feature class to <code>1.2345</code> if the maximum value of Reach-1’s <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> feature class <code>km_to_mouth</code> field is <code>1.2345</code>.</li>
<li>The goal is that longitudinal stationing within a site containing multiple reaches should be sequential and unique throughout the site (i.e., lower station values at the bottom of the site and higher station values at the top of the site). This allows reach feature classes to be combined after reach-level analysis is complete.</li>
<li>The <code>calibration_points</code>, <code>point_id_field</code>, and <code>measure_field</code> parameters can be left blank when processing the <a href="#units_of_analysis">base year</a>.</li>
</ul>
<p><strong>Multiple Surveys</strong><br>
To make LiDAR surveys collected before the <a href="#units_of_analysis">base year</a> directly comparable to the base year, the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> from each previous survey must be <a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/linear-referencing/calibrate-routes.htm">calibrated</a> to the base year. This adjusts any changes in flowline planform between survey events to be expressed in terms of the base year longitudinal stationing.</p>
<ul>
<li>If multiple LiDAR surveys exist for a project study area, the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> for any previous LiDAR survey must be calibrated using the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> of the base year.</li>
<li>For example, if 2016 is the base year, when deriving the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> for a LiDAR survey from 2010, the base year’s <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> (2016) must be used for the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-tool"><code>06 - Flowline Points</code></a> tool’s <code>calibration_points</code> parameter value.</li>
<li>Set the <code>point_id_field</code> and <code>measure_field</code> parameters to the fields in the base year’s <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> feature class.</li>
<li>Set the <code>search_radius</code> parameter to the maximum distance between the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> of the current survey and the base year <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a>.</li>
</ul>
<hr>
</section>
</section>
<section id="define-initial-floodplain-and-channel-extent" class="level2">
<h2 class="anchored" data-anchor-id="define-initial-floodplain-and-channel-extent">Define Initial Floodplain and Channel Extent</h2>
<p>The purpose of this stage is to define the initial floodplain and channel extent, for each reach and survey event.</p>
<section id="detrend-dem" class="level3">
<h3 class="anchored" data-anchor-id="detrend-dem">Detrend DEM</h3>
<p>The purpose of this step is to produce a detrended DEM. A detrended DEM normalizes stream bank elevations for a specific reach.</p>
<ul>
<li>Inspect the reach to determine the width of the active floodplain. Use the measure tool to measure from the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> outward to the widest extent of the active floodplain. This value will be used as the <code>buffer_distance</code> value in the following step.<br>
</li>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#detrend-dem-tool"><code>07 - Detrend</code></a> tool to create a <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#detrend-raster"><code>detrend</code></a> detrended DEM for the study reach. Set the <code>buffer_distance</code> field to a distance wide enough to capture the reach’s entire active floodplain.</li>
</ul>
</section>
<section id="estimate-initial-channel-extent" class="level3">
<h3 class="anchored" data-anchor-id="estimate-initial-channel-extent">Estimate Initial Channel Extent</h3>
<p>The purpose of this step is to use the detrended DEM to visually extract an initial channel extent polygon. The <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#detrend-raster"><code>detrend</code></a> DEM created in the last step can be used to iteratively explore different inundation extents derived from various water surface elevations.</p>
<ul>
<li>Add the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#detrend-raster"><code>detrend</code></a> raster to the map Table of Contents. Name this layer <code>Channel Extent</code>.</li>
<li>On the Symbology tab of the <code>Channel Extent</code> layer, use the Classified renderer to classify the raster into 2 classes. Set the first class boundary to the detrended elevation that you would like to explore. Set the color of the first class (min value - detrended elevation) to blue and the color of the second class (detrended elevation - max value) to No Color.</li>
<li>Set the transparency of the <code>Channel Extent</code> layer to 50%.</li>
<li>Begin to delineate the channel extent by selecting a detrended elevation that inundates the channel up to at least the first terrace. The goal at this stage is to select a detrended elevation that captures the extent of the channel without “spilling” too much water into the floodplain. Once you discover which detrended elevation begins to allow water to access the floodplain, reduce the detrended elevation value slightly to keep the water in the channel. Try several detrended elevation values to help make the decision.</li>
<li>When you have chosen a detrended elevation, use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#water-surface-extent"><code>08 - Water Surface Extent</code></a> tool to extract an initial channel extent area polygon. This tool creates a new polygon feature class named <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#bankfull-area-fc"><code>banks_raw_xxx</code></a>, where xxx is the detrended elevation selected.</li>
<li>This feature class must be edited to select the channel area polygon(s). Open the attribute table for the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#bankfull-area-fc"><code>banks_raw_xxx</code></a> feature class and use advanced sorting to sort first by <code>gridcode</code> and then by <code>Shape_Area</code>. Polygons with <code>gridcode</code> = 1 are polygons inundated at the detrended elevation. Typically, the polygons with the largest area represent the channel. Begin selecting <code>gridcode</code> = 1 polygons with the largest area until the entire channel area is selected.</li>
<li>Export these selected features to a new feature class named <code>initial_channel_extent</code>.</li>
<li>Delete the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#bankfull-area-fc"><code>banks_raw_xxx</code></a> feature class created in this section.</li>
</ul>
</section>
<section id="create-the-initial-channel-mask-layer" class="level3">
<h3 class="anchored" data-anchor-id="create-the-initial-channel-mask-layer">Create the Initial Channel Mask layer</h3>
<p>The purpose of this step is to create a layer that defines an area just beyond the initial channel extent.</p>
<ul>
<li>Add the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#detrend-raster"><code>detrend</code></a> feature class to the map Table of Contents. Name this layer <code>Channel Mask</code>.</li>
<li>In the symbology of this layer, change the renderer from <code>stretched</code> to <code>classified</code>. Set the number of classes to 2. In the <code>classification</code> dialog, set the break value between the two classes to about one to two feet higher than the initial bankfull extent estimate. A couple of feet above the initial bankfull extent estimate should define the extent of the just the channel. For example, if the initial bankfull extent was estimated at 102 detrended feet, the initial bankfull height estimate would be 2 feet. One foot higher than the 2 foot initial bankfull height estimate would therefore be 103 detrended feet.</li>
<li>Set the transparency of the <code>Channel Mask</code> layer to 50%.</li>
</ul>
</section>
<section id="estimate-initial-floodplain-extent" class="level3">
<h3 class="anchored" data-anchor-id="estimate-initial-floodplain-extent">Estimate Initial Floodplain Extent</h3>
<p>The purpose of this step is to create a layer that defines the an initial estimate of the floodplain inundation extent.</p>
<ul>
<li>Add the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#detrend-raster"><code>detrend</code></a> feature class to the map Table of Contents. Name this layer <code>Floodplain Mask</code>.</li>
<li>In the symbology of this layer, change the renderer from <code>stretched</code> to <code>classified</code>. Set the number of classes to 2. In the <code>classification</code> dialog, set the break value between the two classes to four times the initial bankfull extent estimate. Four times the initial bankfull extent estimate should define the extent of the active floodplain. For example, if the initial bankfull extent was estimated at 102 detrended feet, the initial bankfull height estimate would be 2 feet. Four times the 2 foot initial bankfull height estimate would therefore be 108 detrended feet.</li>
<li>Set the transparency of the <code>Floodplain Mask</code> layer to 50%.</li>
</ul>
</section>
<section id="calculate-channel-slope-raster" class="level3">
<h3 class="anchored" data-anchor-id="calculate-channel-slope-raster">Calculate Channel Slope Raster</h3>
<p>The purpose of this step is to create a channel slope raster that can be used in the visual identification of riffle locations in following step.</p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#channel-slope-tool"><code>09 - Channel Slope</code></a> tool to calculate a raster of the channel slope. Use the <code>intitial_channel_extent</code> polygon created earlier to define the channel area within which the slope raster will be calculated. This tool creates a new feature class named <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#channel-slope-raster"><code>channel_slope</code></a>.</li>
</ul>
</section>
<section id="create-initial-centerline" class="level3">
<h3 class="anchored" data-anchor-id="create-initial-centerline">Create Initial Centerline</h3>
<p>The purpose of this step is to create a stream centerline. The centerline represents the rough midline of the stream between the banklines.</p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#centerline-tool"><code>10 - Centerline</code></a> tool to create a <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#centerline-fc"><code>centerline</code></a> polyline feature class representing the stream midline at the estimated bankfull water surface elevation using the <code>initial_channel_extent</code> feature class.</li>
</ul>
<hr>
</section>
</section>
<section id="create-regular-cross-section-geometry" class="level2">
<h2 class="anchored" data-anchor-id="create-regular-cross-section-geometry">Create Regular Cross Section Geometry</h2>
<p>The purpose of this stage is to create regularly spaced stream cross sections and extract terrain-derived hydraulic parameters for each reach and survey event.</p>
<section id="create-regular-cross-sections" class="level3">
<h3 class="anchored" data-anchor-id="create-regular-cross-sections">Create Regular Cross Sections</h3>
<p>The purpose of this step is to create regularly spaced cross sections along each reach.</p>
<ul>
<li>The goal of this step is to create a set of regularly spaced cross sections that well represent the channel conditions found in this reach.</li>
<li>Determine the typical maximum distance from the reach <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> to the edge of the active floodplain. The goal is not to identify the maximum distance to the edge of the floodplain, but to identify the typical distance to the edge of the floodplain.</li>
<li>Determine the spacing between cross sections necessary to represent conditions along this stream. Cross section spacing for small stream of 50-100 feet works well. Larger rivers do not require such tight spacing.</li>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-layout-tool"><code>11 - XS Layout</code></a> tool to create a set of regularly spaced cross sections (referred to as transects in this tool). Use the values determined in the previous steps to set this tool’s parameters.</li>
<li>For a site with multiple reaches, regular cross sections must be uniquely numbered across all reaches. The <code>Seq</code> field values of regular cross sections should not repeat within the reaches of a site.</li>
<li>The downstream-most cross section in the site should be numbered starting with the <code>Seq</code> field value of 1 and increase moving upstream.</li>
<li>The <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-layout-tool"><code>11 - XS Layout</code></a> tool automatically numbers regular cross sections <code>Seq</code> values starting with the value 1 at the downstream-most cross section.<br>
</li>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-resequence-tool"><code>13a - XS Resequence</code></a> tool to set the starting <code>Seq</code> value for each reach.<br>
</li>
<li>For all reaches other than the first reach (downstream-most) in a site, the cross sections must be re-sequenced using the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-resequence-tool"><code>13a - XS Resequence</code></a> tool.</li>
<li>Set the <code>Seq</code> field value for each upstream reach to the upstream-most value (i.e., the highest <code>Seq</code> value of the downstream reach’s regular cross section feature class) of the downstream reach.</li>
<li>For example, set the <code>Seq</code> of the Reach-2 regular cross section feature class to 58 if the maximum value of Reach-1’s regular cross section feature class <code>Seq</code> field is 57.</li>
</ul>
</section>
<section id="calculate-cross-section-watershed-area" class="level3">
<h3 class="anchored" data-anchor-id="calculate-cross-section-watershed-area">Calculate Cross Section Watershed Area</h3>
<p>The purpose of this step is to calculate the watershed area for each regularly spaced cross section.</p>
<ul>
<li>From the study area geodatabase, use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#contributing-area-raster"><code>watershed_contributing_area</code></a> raster that covers the entire contributing watershed of the study area.<br>
</li>
<li>Use the <a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/data-management/clip.htm">ERSI <code>Clip Raster</code></a> tool to clip the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#contributing-area-raster"><code>watershed_contributing_area</code></a> raster to <code>stream_network_buffer</code> to speed tool run time.</li>
<li>Add the <code>contributing_area_buffer</code> raster to a map and symbolize with a “hot-cold” stretch renderer.</li>
<li>Add the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> and regular cross section features classes to the map. Place them on top of the <code>contributing_area_buffer</code> raster.</li>
<li>Determine the maximum distance from the intersection of each cross section and the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> to the nearest pixel of high flow in the <code>contributing_area_buffer</code> raster. This value will be used for the <code>snap_distance</code> in the next step.</li>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-watershed-area-tool"><code>12 - XS Watershed Area</code></a> tool to calculate the watershed area for each cross section.</li>
<li>For the <code>flow_accum</code> parameter, use the <code>contributing_area_buffer</code> raster.</li>
<li>For the <code>snap_distance</code> parameter, use the distance you calculated in a previous step.</li>
</ul>
</section>
<section id="calculate-cross-section-river-position" class="level3">
<h3 class="anchored" data-anchor-id="calculate-cross-section-river-position">Calculate Cross Section River Position</h3>
<p>The purpose of this step is to calculate the river position for each regularly spaced cross section.</p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-river-position"><code>13 - XS River Position</code></a> tool to calculate the distance to the mouth of the river for each cross section.</li>
<li>The river position of each cross section will be used in later steps to calculate several channel parameters (i.e., gradient, sinuosity).</li>
</ul>
</section>
<section id="calculate-cross-section-points" class="level3">
<h3 class="anchored" data-anchor-id="calculate-cross-section-points">Calculate Cross Section Points</h3>
<p>The purpose of this step is to convert each cross section into a set of evenly stationed points and assign DEM and detrended elevation values.</p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-points-tool"><code>14 - XS Points</code></a> tool to calculate cross section station points for each cross section.</li>
<li>The <code>station_distance</code> parameter should be set to approximately the resolution of the DEM. For example, if the DEM has a cell size of 1 foot (0.3048 meter), set the <code>station_distance</code> to that distance (using the linear units of the coordinate system used for the project’s vector data).</li>
<li>This tool creates a new feature class named <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-points-fc"><code>&lt;cross section feature class name&gt;_points</code></a>.</li>
</ul>
</section>
<section id="calculate-cross-section-l1-dimensions" class="level3">
<h3 class="anchored" data-anchor-id="calculate-cross-section-l1-dimensions">Calculate Cross Section L1 Dimensions</h3>
<p>The purpose of this step is to calculate the L1 dimensions for the regularly spaced cross sections.</p>
<p><strong>Determine the moving window size</strong><br>
Many stream metrics are scale dependent, meaning these metrics are affected by the size of the moving window used in their calculation. To determine the appropriate size of the moving window for this reach, use the following steps:</p>
<ul>
<li>Many stream metrics are typically calculated using a moving window size equal to two meander wavelengths (one upstream meander wavelength and one downstream meander wavelength).</li>
<li>Using the initial <code>Channel Mask</code> layer that you created earlier, estimate the typical bankfull width for the reach.</li>
<li>Estimate the length of two meander wavelengths by multiplying the bankfull width estimated in the last step by 10 (e.g., 30ft bankfull width * 10 = 300ft, two meander wavelengths).<br>
</li>
<li>Determine how many cross sections two meander wavelengths represent. For example, if regular cross sections are spaced 100ft apart, then two meander wavelengths would be 3 cross sections (i.e., 300ft / 100ft between cross sections).</li>
</ul>
<p><strong>Calculate L1 Dimensions</strong></p>
<ul>
<li>Use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-dimensions-L1-tool"><code>15a - XS Dimensions, Level 1</code></a> tool to calculate L1 dimensions.</li>
<li>Set the <code>xs_fc</code> parameter to the regular cross sections feature class you created in a previous step.</li>
<li>Set the <code>lead_n</code> parameter to the number of upstream cross sections that you calculated in a previous step.</li>
<li>If the elevations in the channel seem noisy, check the <code>use_smoothing</code> parameter and set the <code>loess_span</code> parameter to a value between 0-1.</li>
<li>Confirm that the <code>vert_units</code> of the DEM are in feet.</li>
</ul>
<p><strong>Confirm the degree of smoothing</strong></p>
<ul>
<li>Use a chart to verify the choice of the smoothing <code>loess_span</code> parameter.</li>
<li>Right-click on the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-dimensions-fc"><code>*_dims_L1</code></a> feature class in the map Table of Contents and select “Create Chart”, and select “Line”. In the <code>Date or Number</code> dropdown, choose the field <code>POINT_M</code>. In the <code>Aggregation</code> dropdown, choose <code>None</code>. In the <code>Numeric field(s)</code> checklist, check the boxes next to <code>Z</code> and <code>Z_smooth</code>. Click the <code>Apply</code> button to view the chart.</li>
<li>Visually assess the degree of smoothing. The smoothing should be high enough to eliminate LiDAR elevation noise, but not so high as to eliminate meaningful channel elevation change.</li>
<li>If the smoothing is not ideal, re-run the tool and adjust the <code>loess_span</code> parameter.</li>
</ul>
<hr>
</section>
</section>
<section id="identify-infrastructure" class="level2">
<h2 class="anchored" data-anchor-id="identify-infrastructure">Identify Infrastructure</h2>
<p>The purpose of this stage is to identify salient features in the floodplain that may be affecting channel hydraulics along each reach. Here are some ideas for the features you should identify:</p>
<ul>
<li>Significant tributaries</li>
<li>Built infrastructure</li>
<li>Significant geologic features</li>
</ul>
<section id="create-features" class="level3">
<h3 class="anchored" data-anchor-id="create-features">Create Features</h3>
<p>The purpose of this step is to identify the longitudinal position of noteworthy stream features for graph and map labeling.</p>
<ul>
<li>Create a new point feature class named <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#features-fc"><code>features</code></a> containing the following fields:
<ul>
<li><code>Name</code> - Text (50), Used to record the name of the river feature.</li>
<li><code>km_to_mouth</code> - double, Used to record the feature’s longitudinal position within the reach.</li>
</ul></li>
<li>Working upstream from the downstream end of the reach, examine the DEM and aerial imagery for significant river features and built infrastructure that could potentially impact stream structure and function.</li>
<li>Add the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> feature class to the current map.</li>
<li>Set the display field to the <code>km_to_mouth</code> field.</li>
<li>Create a <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#features-fc"><code>features</code></a> point feature centered along the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class.</li>
<li>Assign it a descriptive label in the <code>Name</code> field, and record its longitudinal position along the reach (see next bullet) in the <code>km_to_mouth</code> field.</li>
<li>To determine a feature’s longitudinal position along the reach, use the identify tool to find the closest point in the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-points-fc"><code>flowline_points</code></a> feature class and use the value from its <code>POINT_M</code> value.</li>
<li>Repeat these steps to record all of the significant features along each reach.</li>
</ul>
<hr>
</section>
</section>
<section id="run-report" class="level2">
<h2 class="anchored" data-anchor-id="run-report">Run Report</h2>
<p>The purpose of this stage is to run the Level 1 report for each reach.</p>
<section id="run-the-level-1-report" class="level3">
<h3 class="anchored" data-anchor-id="run-the-level-1-report">Run the Level 1 Report</h3>
<p>The purpose of this step is to run the L1 report for each reach. The Level 1 Report displays the channel dimensions for the base year, compared with multiple previous year surveys.</p>
<ul>
<li>In the Reports toolset, use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#L1-report-tool"><code>Level 1 Report</code></a> tool to produce the Level 1 Report.</li>
<li>For the <code>stream</code> parameter, use the value of the <code>ReachName</code> field used in the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class.</li>
<li>For the <code>flowline_fc</code> parameter, enter the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#flowline-fc"><code>flowline</code></a> feature class for the base year survey.</li>
<li>For the <code>xs_dimensions_fc</code> parameter, use the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#xs-dimensions-fc"><code>*_dims_L1</code></a> feature class calculated for the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#regular-xs-fc">regular cross sections</a> of the base year.</li>
<li>The <code>flowline_points_*</code> parameters should be entered with the feature class for the most recent survey first (i.e., the base year) and then the previous surveys in reverse chronological order (e.g., 2016, 2010, 2006).</li>
<li>The <code>xs_points_*</code> parameters should be entered with the feature class for the most recent survey first (i.e., the base year) and then the previous surveys in reverse chronological order (e.g., 2016, 2010, 2006).</li>
<li>The <code>survey_name_*</code> parameters are used to label the surveys in maps and graphs.</li>
<li>The feature classes and labels used for the <code>flowline_points_*</code>, <code>xs_points_*</code>, and <code>survey_name_*</code> parameters must be entered in the same order (e.g., 2016, 2010, 2006) in each set of numbered parameters.</li>
<li>For the <code>features_fc</code> parameter, enter the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#features-fc"><code>features</code></a> feature class for the base year survey.</li>
<li>For the <code>dem</code> parameter, enter the <a href="https://www.techmanual.fluvialgeomorph.org/toolbox.html#dem-hydro-raster">DEM</a> for the base year survey.</li>
</ul>
</section>
<section id="perform-qa" class="level3">
<h3 class="anchored" data-anchor-id="perform-qa">Perform QA</h3>
<p>The purpose of this step is to use the QA Checklist to verify the reports have run correctly and identify any data mistakes that need to be corrected.</p>
<ul>
<li>Follow the instructions in the QA Checklist Chapter, <a href="4-1-QAChecklist.html#L1_report_qa">Level 1 Report</a>, to verify that the reports have run correctly.</li>
<li>Make the required changes suggested in the QA Checklist and rerun the report.</li>
<li>Repeat these QA iterations until the reports are correct.</li>
</ul>
<hr>
</section>
</section>
<section id="determine-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="determine-next-steps">Determine Next Steps</h2>
<p>The purpose of this step is to determine what further steps need to be taken.</p>
<ul>
<li>Review the results of the Level 1 Report and determine if the project goals require proceeding to developing the Level 2 analysis.</li>
</ul>
<hr>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./3-2-CreateTerrain.html" class="pagination-link" aria-label="Create Terrain">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Create Terrain</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./3-4-Level-2.html" class="pagination-link" aria-label="Level 2 Workflow">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Level 2 Workflow</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Made with love by USACE</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>